name: Automatic Build
on:
  push:
    branches:
      - 'master'
    paths:
      - '.github/workflows/**'
      - 'pkgs/**'
      - 'flake.lock'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install nix
      uses: cachix/install-nix-action@v27
      with:
        nix-path: nixpkgs=channel:nixpkgs-unstable
        extra_nix_config: |
          experimental-features = nix-command flakes

    - name: Build packages
      uses: cachix/cachix-action@v15
      with:
        name: passivelemon
        authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'
    - run: |
        nix build -L .#alvr \
                      .#animdl-git \
                      .#gdlauncher-carbon \
                      .#gdlauncher-carbon-unstable \
                      .#gdlauncher-legacy \
                      .#gfm \
                      .#hd2pystratmacro \
                      .#hd2pystratmacro-git \
                      .#monado-vulkan-layers-git \
                      .#poepyautopot \
                      .#poepyautopot-git \
                      .#tilp2 \
                      .#wivrn \
                      .#wivrn-git

